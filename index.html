<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Browser Game</title>
</head>
<body>
    <canvas id="ctx" width="500" height="500" style="border:1px solid black;"></canvas>

<script>

        const HEIGHT = 500;
        const WIDTH = 500;
        const HEALTH = 10;
        
        var timeWhenGameStarted = Date.now();
        var ctx = document.getElementById("ctx").getContext('2d');
        ctx.font='30px Arial';
       //player
       var player = {
        x : 50,
        spdX : 30,
        y : 40,
        spdY : 5,
        name : "O",
        hp:HEALTH

       }
       //enemy
       var enemyList ={};

       

       //get distance between player and enemy

       GetDistanceBetweenEntity = function (entity1, entity2){
           var vx = entity1.x - entity2.x;
           var vy = entity1.y - entity2.y;

           return Math.sqrt(vx*vx + vy*vy);
       }

       TestCollisionEntity = function (entity1, entity2){
            var distance = GetDistanceBetweenEntity(entity1, entity2);
            return distance<30;
       }

       //Create Enemy
       CreateEnemy = function (id, name, x, y, spdX, spdY){
        var enemy = {
        id:id,
        name : name,
        x : x,
        y : y,
        spdX : spdX,
        spdY : spdY
       }
       enemyList[id] = enemy;
       }

       document.onmousemove = function(mouse){
           var mouseX = mouse.clientX;
           var mouseY = mouse.clientY;

           player.x = mouseX;
           player.y = mouseY;
       }


       UpdateEntity = function (entity){
         DrawEntity(entity);
         UpdateEntityPosition(entity);
    }

    DrawEntity = function(entity){
        ctx.fillText(entity.name,entity.x, entity.y);
    }

    UpdateEntityPosition = function(entity){
        entity.x+= entity.spdX;
        entity.y+= entity.spdY;

        if( entity.x > WIDTH || entity.x < 0){
            entity.spdX = -entity.spdX;
        }
        if( entity.y > HEIGHT || entity.y<0){
           entity. spdY = -entity.spdY;
        }
    }
    

    Update = function (){
        ctx.clearRect(0, 0, WIDTH, HEIGHT);
       for(var key in enemyList){
           UpdateEntity(enemyList[key]);

           var isColliding = TestCollisionEntity(player, enemyList[key]);

           if(isColliding){
                player.hp -= 1;
                if(player.hp<=0){
                    var timeSurvived = Date.now() - timeWhenGameStarted; 
                    alert('GAME OVER.\nSCORE :' + timeSurvived + " ms.");
                    timeWhenGameStarted = Date.now();
                    player.hp = HEALTH;
                }
           }
       }
        DrawEntity(player);
        ctx.fillText(player.hp + " Hp", 0, 30);
    }

       CreateEnemy("E1", "D", 150, 350, 10, 15);
       CreateEnemy("E2", "D", 250, 350, 10, -15);
       CreateEnemy("E3", "D", 100, 200, 10, -35);
       
       setInterval(Update, 50);

</script>
</body>
</html>